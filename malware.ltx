\documentclass[style=fyma,palette=blue,mode=present]{powerdot}
%% Uses the Powerdot package
%% - https://www.sharelatex.com/learn/Powerdot
%% - ftp://bay.uchicago.edu/tex-archive/macros/latex/contrib/powerdot/doc/powerdot.pdf
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{epsfig}
\usepackage{anyfontsize}
\usepackage{url}
\usepackage{graphicx}
\usepackage{verbatim}
\pdsetup{
 palette=blue,
 lf=Malware Analysis on a Budget,
 rf=Security BSides Cincy 2016
}
\title{Malware Analysis on a Budget}
\author{Coleman Kane\\Coleman.Kane@ge.com\\kaneca@mail.uc.edu\\@colemankane\\\url{https://github.com/ckane}}
\date{May 21 2016}
\begin{document}
\maketitle

\begin{slide}{/me}
\begin{itemize}
\item Security Operations, Cyber Intelligenge for GE Aviation
\item Ph. D. candidate, Computer Science Engineering\\Cyber Operations track, University of Cincinnati
\item B.S. Computer Engineering, University of Cincinnati
\item CRITs project contributor
\item FreeBSD community member \& contributor since 2001
\item 6 years experience in IT Security, at least 10 years in CS and IT
\item Cincinnati native
\item Running (because I like cake)
\item 6 year old daughter
\item Fancies cats
\end{itemize}
\end{slide}

\begin{slide}{What is malware?}
A very good place to begin is to define what is considered to be "malware". In my experience, in
attacks, there are two classes of malware:
\begin{enumerate}
 \item Artifacts designed to be used for malicious purposes (attack tools, exploits, etc.)
 \item Artifacts designed for legitimate use, that are also used for malicious attacks
\end{enumerate}

The second case will involve tools that may or may not be classifiable in every context
as "malware" within your environment.

\end{slide}

\begin{slide}{Focus on Artifacts Designed for Malicious Purposes}
In analyzing attacks, all artifacts collected are useful when analyzing the attack. However, when starting
out, it is recommended to focus analysis efforts on artifacts authored for malicious purposes. This helps
you focus on identifying what definitely should not exist in your (or anyone else's) environment.

Most of what you will encounter shared in the community comes from this pool, as well.

{\center \textbf{In a nutshell: It gives you ground to build from\\}}
\end{slide}

\begin{slide}{Why Do Malware Analysis?}
A very valid question to ask yourselves:\\
\begin{itemize}
 \item\textit{What are you trying to get out of malware analysis?}
\end{itemize}

\vspace{0.1in}
When building a security program, a core goal of malware analysis should be to document unique
characteristics of malicious artifacts, in order to detect (and even prevent) them when
they are introduced in your environment.

\vspace{0.1in}
If you are building a program on a budget, time dedicated to less-actionable discoveries may be
time wasted. It is important to survey your environment \& capabilities, and focus analysis work
on investigations that can inform your security program.

\vspace{0.1in}
Build a chart, mapping analysis outputs to program inputs.

\vspace{0.1in}
As your security program matures, similarly mature your analysis program.

\end{slide}

\begin{slide}{Two Faces of Malware Analysis}
There are primarily two sides to malware analysis. Gathering data on both of them is
important:
\begin{itemize}
 \item\textbf{Dynamic}: When the malware is executing, what effect does it have on the host system and
                        your networked environment?
 \item\textbf{Static}: When the malware is not executing, what characteristics distiguish its data from
                       the rest of the artifacts in your environment (including other malware).
\end{itemize}

We will briefly go over a number of analysis tools that our team and colleagues have found to be helpful.
Most of them fall into one of the two above categories, however some of them can assist with both.

\end{slide}

\begin{slide}{Analysis Hardware}
I have found it helpful to use a separate system for analysis, frequently a Linux server that I can log
into. When a Windows environment is needed, I can utilize Virtual Machines via RDP on this server. I
recently went out and purchased the following hardware, for approximately \textbf{\$400}.

\begin{itemize}
 \item Asus M5A97 Motherboard (o/b NIC, HDMI): \$60
 \item Case w/ Power: \$30
 \item AMD FX 8320E CPU (8 core, 3.2GHz): \$90
 \item 3TB SATA HD 7200rpm: \$80
 \item 32GB RAM (4x8GB): \$140
\end{itemize}

I put Ubuntu 16.04 onto it, in my case, and it installed pretty easily.
\end{slide}

\begin{slide}{Dynamic: Cuckoo Sandbox and Virtualbox VM}
Dynamic analysis requires a safe and isolated environment to execute malicious software, such that
it doesn't expose you to undesired risk.
\begin{itemize}
 \item Oracle Virtualbox (\url{http://virtualbox.org}) is a free and (mostly) open-source platform
       to provide virtual machine environments
 \item Cuckoo Sandbox (\url{http://cuckoosandbox.org}) is also free, and provides monitoring and
       data management for VM's with a focus on our use case of malware analysis
 \item VMCloak (\url{http://vmcloak.org}) is also free, and provides a helpful framework for automating
       the maintenance work involved in creating sandbox VM images
\end{itemize}

Oracle Virtualbox offers RDP and VNC options for its VM's so that you may interact with a system
while it is executing malware. You can also install Virtualbox on your desktop/laptop, and use the
same VMs there.
\end{slide}

\begin{slide}{Dynamic: Sandboxes}
In many cases, I have found that it is more valuable to build a few "least secure" images of varying
configurations, than attempting to recreate your environment's "default build".

\vspace{0.1in}
\textbf{Why?}: Because chances are better than not that configuration variance across your environment
is high. Your systems are secured when they leave IT. Then you let your users have them.

\vspace{0.1in}
You want to collect and document \textbf{what would happen if the attack is successful}, rather than
use the tools to "validate your newly-issued hardware is secure". The latter is a valuable data point
to know, but save that for when you have ample funding for it as a project of its own.
\end{slide}

\begin{slide}{Dynamic: Debuggers}
For the analyst with machine-code/disassembly expertise, additional debugging tools have been
developed which can help in the analysis of malware.
\begin{itemize}
 \item Immunity Debugger (\url{http://debugger.immunityinc.com})
\end{itemize}
\end{slide}

\begin{slide}{Static Analysis Overview}
There are a large amount of static analyzers out there. The below families describe some types of
static analyzers that should be helpful in quickly getting your system off the ground:
\begin{itemize}
 \item\textbf{Meta-analyzers}: Analysis engines that are comprised of multiple analysis stages and
                               document deep inspection findings in a structured output
 \item\textbf{Disassemblers}: Tools developed to identify machine code and convert it into human
                              readable instruction mnemonics
 \item\textbf{Parsers}: Tools used to parse structured, typically binary, file formats into human
                        readable reports, and even extracted artifacts they contain
 \item\textbf{Decompilers}: Kind of hybrid between parser \& disassembler - can convert bytecode
                            into source code
 \item\textbf{Scanners}: Tools used to scan contents, activity logs, and other artifacts for signatures
                         of malicious activity
 \item\textbf{Exploration Tools}: Tools used, typically visually, to explore the artifacts, their
                                  structure and contents
\end{itemize}
\end{slide}

\begin{slide}{Scanners}
Some ``scanners'' you may be familiar with include most ``signature based'' Anti-Virus systems, such as
Sophos, Symantec, McAfee. In many cases, these maintain a database of virus definitions that amount to
patterns that recognize unique content within malicious files. Typically, you cannot add new information
to this database yourself.

\vspace{0.1in}
Victor Alvarez's Yara Project: \url{http://plusvic.github.io/yara/}

\vspace{0.1in}
Probably the most widely used tool for building your own signature database. Lots of open-source
places to start:

\begin{itemize}
 \item\url{https://github.com/Yara-Rules/rules/}
 \item\url{https://github.com/Xen0ph0n/YaraGenerator}
 \item\url{https://malwareconfig.com/yara/}
\end{itemize}

\end{slide}

\begin{slide}[method=direct]{Scanners (yara example)}
{\tiny
\begin{verbatim}
rule Tinba2 {
 meta:
  author = "n3sfox <n3sfox\@gmail.com>"
  date = "2015/11/07"
  description = "Tinba 2 (DGA) banking trojan"
  reference = "https://securityintelligence.com/tinba-malware-
               reloaded-and-attacking-banks-around-the-world"
  filetype = "memory"
  hash1 = "c7f662594f07776ab047b322150f6ed0"
  hash2 = "dc71ef1e55f1ddb36b3c41b1b95ae586"
  hash3 = "b788155cb82a7600f2ed1965cffc1e88"

 strings:
  $str1 = "MapViewOfFile"
  $str2 = "OpenFileMapping"
  $str3 = "NtCreateUserProcess"
  $str4 = "NtQueryDirectoryFile"
  $str5 = "RtlCreateUserThread"
  $str6 = "DeleteUrlCacheEntry"
  $str7 = "PR_Read"
  $str8 = "PR_Write"
  $pubkey = "BEGIN PUBLIC KEY"
  $code1 = {50 87 44 24 04 6A ?? E8}

 condition:
  all of ($str*) and $pubkey and $code1
}
\end{verbatim}
}
\end{slide}

\begin{slide}[method=direct]{Scanners (yara regex example)}
{\tiny
\begin{verbatim}
rule jRat
{
 meta:
  author = " Kevin Breen <kevin@techanarchy.net>"
  date = "2014/04"
  ref = "http://malwareconfig.com/stats/jRat"
  maltype = "Remote Access Trojan"
  filetype = "Java"

 strings:
  $meta = "META-INF"
  $key = "key.dat"
  $conf = "config.dat"
  $jra1 = "enc.dat"
  $jra2 = "a.class"
  $jra3 = "b.class"
  $jra4 = "c.class"
  $reClass1 = /[a-z]\.class/
  $reClass2 = /[a-z][a-f]\.class/

 condition:
  ($meta and $key and $conf and #reClass1 > 10 and #reClass2 > 10)
  or ($meta and $key and all of ($jra*))
}
\end{verbatim}
}
\end{slide}

\begin{slide}{Parsers}
Your users work with many structured file types in their daily work. Structures within
these files are leveraged by adversaries to target vulnerabilities in specific parts of
the applications used to open them.

\vspace{0.1in}
When analyzing these attacks, it is important to use a parser that doesn't happen to be
composed of the same software code targeted by the exploit. The community has built a number
of parsers for common file formats to meet this need.

\end{slide}

\end{document}
